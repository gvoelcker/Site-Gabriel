---
title: 'Introduction to Benford''s Law basics'
author: Gabriel Voelcker
date: '2018-08-10'
slug: benford-s-law-using-r
categories: []
tags:
  - r
  - benford
  - distribution
  - accounting
  - fraud
Description: ''
Tags: []
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE)
```

```{r packages, echo=FALSE, message=FALSE, include=FALSE}
library(GetDFPData)
library(tidyverse)
library(benford.analysis)
library(BenfordTests)
library(dplyr)
library(dygraphs)
library(readxl)
library(blogdown)
library(writexl)
library(rstudioapi)
library(magrittr)
library(ggplot2)
library(ggthemes)
library(scales)
library(dslabs)
library(lubridate)
require(zoo)
library(BatchGetSymbols)
require(xfun)
xfun::pkg_load2(c('base64enc', 'htmltools', 'mime'))

library(knitr)
library(kableExtra)

```
In 2016 I had the opportunity to take a class in my masters entitled Econophysics. Econophysics is a field of study that applies methods and theories developed by physicists to economic problems. Around that time I came across a very interesting phenomenon called Benford's Law. This post is an introduction to Benford's Law using RStudio. Let's start by understanding what Benford's Law is.

I am thinking of a number from 1 to 99. You have 2 seconds to guess which is the first **digit** of that number. 

1.

2.

Which number did you choose? Actually, that's irrelevant! My intention here is to make you reflect on this question: what were the odds of you correctly guessing the first digit? 

1/9, right? There were 9 possibilities(1,2,3,4,5,6,7,8,9), since 0 is not a first digit among the possibilities I've described. So, if you chose 4, in 11 of 99 possible outcomes you would've pick correctly (4,40,41,42,43,44,45,46,47,48,49). So far, simple math. This is illustrated by the figure below. 

```{r Digit, echo=FALSE, message=FALSE, include=FALSE}
Base <- read_excel("Base.xlsx", sheet=1, col_names = TRUE)
```

```{r Beta, tidy=FALSE, echo=FALSE, message=FALSE, include=TRUE, warning=FALSE}
Graf1 <- ggplot(data = Base, mapping = aes(Digit, as.numeric(Distribution))) +
  geom_col() +
  theme_economist(base_size = 12) +
    scale_y_continuous(name="Distribution", limits=c(0, 0.22), breaks=c(0,0.11,0.22), labels = percent) +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_x_continuous(name = "First Digit", breaks=c(Base$Digit)) + 
  ggtitle("1st Digit Distribution")
Graf1
```

But let me ask you now about a different set of numbers, say, the first 1000 occurrences of the Fibonacci sequence?(Any number of the Fibonacci sequence is the sum of the previous two numbers, so: 1,1,2,3,5,8,13... and so forth). Would you say that your odds of guessing correctly would remain 1/9 were you to choose 4 again? Let me show you the distribution.

PLOT 2ˆnˆ DISTRIBUTION HERE

```{r}
Base <- read_excel("Fibonacci.xlsx", sheet=1, col_names = TRUE)
```



The answer is no! What we have here is a very peculiar mathematical phenomenon called Benford's Law. Thanks to two gentlemen, Simon Newcomb and Frank Benford, there's a good story behind that answer. In [**1881**](http://gerry.lamost.org/upload/newcomb.pdf), Simon Newcomb, an astronomer, noticed that the first pages of a logarithm book were usually more worned out than the later ones. From this, he derived his intuition that given a list of arbitrary numbers more numbers will tend to begin with an "1" than any other digit. So, why is it called Benford's Law, and not Newcomb's law? (that's a classic case of [**Stigler's Law**](https://io9.gizmodo.com/5820736/stiglers-law-why-nothing-in-science-is-ever-named-after-its-actual-discoverer)[and no, this law is named after this [**Stigler**](https://galton.uchicago.edu/faculty/stigler.shtml), not his [**father**](https://research.chicagobooth.edu/stigler/about/george-stigler), the economist and Nobel Laureate]).

Well, it wasn't until [**1938**](https://www.jstor.org/stable/984802?seq=1#page_scan_tab_contents) that physicist Frank Benford formalized this discovery, which he regarded as the Law of Anomalous Numbers. He tested the distribution of the first digit of 20 different samples, and concluded that in populations of exponential growth, the distribution of the first digit followed a certain pattern. What is this pattern? If **d** is the first digit, with d(d E{1,2,...,9}), then: 

$$P(d) = \log_{10}(d+1) - \log_{10}(d) = \log_{10}(\frac{d+1}{d}) = \log_{10}(\frac{d+1}{d})$$

Substituting d for the nine digits, we have the following results:

```{r tables-mtcars, tidy=FALSE, echo=FALSE, message=FALSE, include=TRUE, warning=FALSE}
Base <- read_excel("Base.xlsx", sheet=1, col_names = TRUE)
Benford <- as.data.frame(cbind(Base$Digit, Base$Benford))
colnames(Benford) <- c("Digit", "Distribution")
knitr::kable(Benford[], caption = 'Benford Distribution')
```

If we plot this distribution, we get:

```{r, Benforddist, tidy=FALSE, echo=FALSE, message=FALSE, include=TRUE, warning=FALSE}
Base <- read_excel("Base.xlsx", sheet=1, col_names = TRUE)
Benford <- as.data.frame(cbind(Base$Digit, as.numeric(Base$Benford)))
ggplot(data = Base, mapping = aes(Digit, Benford)) +
  geom_col() +
  theme_economist()+
   scale_y_continuous(name="Distribution", limits=c(0, 0.35), breaks=c(0,0.05,0.1,0.15,0.2,0.25,0.3,0.35), labels = percent) +
  scale_x_continuous(breaks=c(Base$Digit)) + 
  theme(plot.title = element_text(hjust = 0.5)) +
  ggtitle("Benford Distribution")

  
```

But, as one of my academics advisors used to always ask me, what is the purpose of this information? The beauty of Benford is how applicable this distribution is to different sets of numbers. In 1972, [**Hal Varian**](http://people.ischool.berkeley.edu/~hal/) suggested that the Benford distribution could be used to detect accounting frauds. The literature [**w**](https://search.proquest.com/openview/7d019c616546c4c5da54cba2c85d136d/1?pq-origsite=gscholar&cbl=31718)[**o**](https://www.db-thueringen.de/servlets/MCRFileNodeServlet/dbt_derivate_00028759/ilm1-2013200266.pdf)[**r**](http://jhr.uwpress.org/content/44/1/1.short)[**k**](https://amstat.tandfonline.com/doi/abs/10.1198/000313007X223496)[**s**](https://www.ams.org/journals/proc/1995-123-03/S0002-9939-1995-1233974-8/) applied Benford's distribution to investigate a variety of datasets. 

Statistically speaking, when data should conform to Benford’s law, a null-hypothesis rejection suggests that some form of data manipulation has taken place. Now it is time to use R to test empirically Benford's distribution.

There are two packages that can get the job done: [**BenfordTests**](https://cran.r-project.org/web/packages/BenfordTests/BenfordTests.pdf) and [**benford.analysis**](https://cran.r-project.org/web/packages/benford.analysis/benford.analysis.pdf). Let's go through to the basics together. 

Let's use this database, which uses the first 1000 instances of 2^n^. BenfordTests provides a series of test to see if your database conforms to Benford's Law. For example, let's use a Kolmogorov-Smirnov test:

```{r}
DataBenford <- read_excel("dataBenford.xlsx", sheet=1, col_names = TRUE)
Test1 <- as.numeric(DataBenford$First_Digit)
ks.benftest(Test1, digits = 1, pvalmethod = "simulate")
```

Or a Chi-Square test:
```{r}
library(BenfordTests)
chisq.benftest(Test1, digits = 1)
```

Or a Euclidean Distance test:
```{r}
library(BenfordTests)
edist.benftest(Test1, digits = 1)
```

Or a Hotelling T Square test:
```{r}
library(BenfordTests)
jointdigit.benftest(Test1, digits = 1)
```

As you can see, BenfordTests have a variety of tests that you can use to test Benford's Law in set a of numbers. The most important part is to interpret them. But the packages contain more than just tests. It is possible to perform a graphical analysis of the first significant digits:

If you are a fan of math, there's still a lot you can learn about Benford's law [**here**](http://mathworld.wolfram.com/BenfordsLaw.html).
